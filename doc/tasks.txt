Phase 1a - core functionality
-----------------------------

[ ] add search to navbar
    [ ] add location search to the toolbar RHS?
    [y] finish bulletin results
    [y] combine search into single facility, open dropdown?, menubar RH end,
        add advanced search page
    [y] text search page should use GET so you can go back to it
    [ ] clean up references to photo/gphoto links 

[ ] reimplement txt pages as markdown
[ ] fix photos/owner.php (via contributers.php)
[ ] fix loading errors in web console?
[ ] get rid of photo modal in locations/details.latte (include c/tpl/...)

[ ] maybe compact register/login/settings/logout
[ ] return to open tab on refresh
    https://stackoverflow.com/questions/18999501/bootstrap-3-keep-selected-tab-on-page-refresh

[ ] questions for faq, photo submission
[ ] add about/plans.txt
[ ] rewrite landing page text

[ ] fix security issues
    [y] move templates out of public_html
        [y] remove Latte instance from caller to display_page()
    [y] move PHP function code out of public_html
    [y] move any other non-php code out of public_html
    [y] move *all* code into functions, leaving php files as stubs??
        [y] lines
        [y] locations
        [y] infrastructure
        [y] photos
        [y] maps
        [y] articles
        [y] search
        [y] about
        [y] c

    [y] function to extract and type-check GET/POST values - rm quote_external
    [y] deprecate use of $_REQUEST
    [y] remove error check from database function calls
    [ ] review all unescaped HTML output in Latte templates
    [ ] HTML checker on post-markdown output
    [ ] session best practices
        [ ] re-session on privilege changes
    [ ] look at moving to PDO?
    [ ] throw exceptions on all errors, espcially from library code
        [y] throw exceptions on mysqli errors
    [ ] set appropriate headers in HTTP replies
    [ ] sanitise uploaded file types and names
    [ ] disable php execution in /media
    [ ] add a random CSRF token to each form?
    [ ] validate all SQL construction
    [ ] log errors to log/* (log_errors=On, error_log=...)
    [ ] php.ini
        [ ] disable allow_url_fopen, allow_url_include
    [ ] fold menu.cfg into main config file?

[y] deprecate prettyPhoto stuff
[ ] fix photo gallery layout on mobile
[ ] Tenterfield in line detail page has blank close date
[ ] colliery line symbols aren't consistent...
[ ] clean up expired tourist lines, e.g. Dumaresq - Glen Innes

[ ] look at using git pulls to update the public server
[ ] add capability to run DDL scripts on the server for updates?
[ ] separate dev and master databases
[ ] look at regression testing using splinter
[ ] check page functionality for whole site
[ ] check mobile functionality
[ ] https on production system (+ test)


Phase 1b - remaining new functionality
--------------------------------------

[ ] implement "forgot password" functionality (via email link)
[ ] add user settings page including password
[ ] gallery: add facility to edit photo metadata or unpublish
[ ] gallery: add facility to contact copyright owners + legacy
[ ] think about migrating existing photo suppliers to users

[ ] update information/faq page
[ ] send information/faq email on registration
[ ] allow users to change their email address (via old email link?)

[ ] log internal error stack traces to a log file
[ ] cron: email weekly audit trail to me

[ ] add facility to take site offline

[ ] test.nswrail.net: check login works
[ ] test.nswrail.net: check register works (need smtp server)
[ ] test.nswrail.net: check photo upload works
[ ] mechanism to push changes to test and production via github
[ ] release to public

Phase 1c - optional improvements
--------------------------------

[ ] check all tables for large/small layout
[ ] clean up explicit style attributes, .css files etc
[ ] move all images to /media (e.g. maps/images, maps/ovmaps)
[ ] track down orphaned photos (files only)
[ ] landing page text should be in the database?
[ ] document functions + doxygen

[ ] add forward/back arrows to location gallery
[ ] extract gallery modal into separate code/template
[ ] gallery: centre images horizontally in columns
[ ] gallery: #columns should be responsive
[ ] gallery: make into an infinite scroller?
[ ] gallery: change display, order by into dropdown with JS action
[ ] gallery: add facility to moderate photos
[ ] gallery: add facility to report an issue
[ ] gallery: add facility to show held, reported photos

[ ] re-enable full-screen google maps?
[ ] re-enable "by-year" maps?
[ ] script to re-associate existing photos with a new account
[ ] auto-generate cards from directory contents?
[ ] admin maintenance: add js form validation
[ ] script: delete old unconfirmed accounts
[ ] admin screen: show audit records
    - restrict by type, date, user etc
[ ] lock account on too many failed logins
[ ] muser.py: update account: set password?
[ ] muser.py: create new account
[ ] screen to maintain tags
[ ] get photo tags from database
[ ] maybe move photos out of public_html?
[ ] add moderation facility
[ ] add support for anonymous users
[ ] add support for specifying a default licence
[ ] cron: script to purge stale images in the staging area
[ ] review photos:
    [ ] 9 in status U => "review"
    [ ] 100 in status s => "dup" (Paul Burgess)
    [ ] 240 in status N, unreleased => "admin1"
    [ ] 338 in status N, released => "admin2"
[ ] cron: automated backups (photos & database)
[ ] re-enable lines/missing.php?


Phase 2
-------

[ ] document requirements for data maintenance
[ ] work out how to generate line icons on-the-fly
[ ] implement maintenance screens - lines
[ ] implement maintenance screens - locations
[ ] implement data addition screens

Phase 3
-------

[ ] look at integrating hairyleg's maps data
[ ] script to split large KML into <5M chunks fgor google maps
[ ] look at setting up a new state from scratch
[ ] add more states?


Completed
---------

[y] move passwords etc out of public_html
[y] script: view/update accounts (muser.py)
    y list accounts
    y list accounts - select by enabled/disabled
    y list accounts - select by role
    y display account details
    y update account: set/clr status
    y update account: set/clr role
[y] login via bootstrap dialog (or new page)
[y] add role to r_user
[y] move git repo up 1 level
[y] rollback on error
[n] error page -> bootstrap dialog?
[n] registration form -> bootstrap button; add cancel
[y] split config into dev/prod
[y] move initialisation code to a function
[n] move secure config to $HOME
[y] get rid of l/* tree
[y] admin screen: same functionality as view/update accounts script
[y] move php code to lib; make functions only
[y] implement authorisation mechanism
[y] show menu entries based on authorisation
[y] doco: code standard
[y] make sure code meets standards
[y] clean up auth_priv_* references
[y] clean up direct inclusion of lib/*.inc files
[y] fix tabs on location pages
[y] photo upload: multi-photo front end
[y] implement delete callback for uploaded files
[y] on upload, create thumbnail and send back URL
[y] design photo naming and location convention
[y] work out how to handle legacy photos
[y] photo validation: type, max size, max dimensions etc
[y] photo annotation/deletion and publishing page
[y] audit all upload operations
[y] fix location photo gallery
[y] implement photo publishing
[y] local bootstrap + sass build
[y] strip old CSS out, move to bootstrap-sass for all
[y] move to card-page layout for infrastructure
[y] move to card-page layout for articles
[y] re-design landing page
[y] migrate pages to basic bootstrap styling
[y] try making card pages pure 2-column
[y] switch to single "lines" page (tabs)
[y] move to card-page layout for photos (with examples)
[y] try a different sans-serif font
[y] move to card-page layout for maps (with thumbnails)
[n] add home icon to LH end of menu bar
[y] add cards requiring authentication
[n] better implementation for random photos
[n] move menu config into database?
[y] move to card-page layout for About
[y] verify initial production test system: test.nswrail.net
[y] tunnel: on mobile, drop photos, distance, between columns
[y] fix line icons to be longer, but auto-cropped in table
[y] fix line page layout
[y] fix google maps for locations
[y] fix location page layout
[y] click on img-thumbnail should display over the top
[y] use modal dialog on location photos as well
[y] gallery: parameterize "history" definition
[y] gallery: full-size image should be modal dialog
[y] use modal photo viewer in photo theme listings as well
[y] re-add administration tools to menu
[y] anything which a user can change must pass through htmlentities()
[y] replace templating engine with latte
    [y] convert index.php to latte
    [y] convert about to latte
    [y] convert infrastructure, trivia to latte
    [y] convert maps to latte
    [y] convert locations to latte
    [y] convert c to latte
